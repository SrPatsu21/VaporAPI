version: '3.8'

services:
# Config Servers
    configdb-replica0:
        container_name: configdb-replica0
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - configdb-replica0_db:/data/db
            - configdb-replica0_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/scripts/entrypoint-configserver.sh"]
        restart: always

    configdb-replica1:
        container_name: configdb-replica1
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - configdb-replica1_db:/data/db
            - configdb-replica1_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/scripts/entrypoint-configserver.sh"]
        restart: always

    configdb-replica2:
        container_name: configdb-replica2
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - configdb-replica2_db:/data/db
            - configdb-replica2_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/scripts/entrypoint-configserver.sh"]
        restart: always

# Shard 0 Replica Set
    shard0-replica0:
        container_name: shard0-replica0
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - shard0-replica0_db:/data/db
            - shard0-replica0_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/bin/sh", "/scripts/entrypoint-shard0.sh"]
        restart: always

    shard0-replica1:
        container_name: shard0-replica1
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - shard0-replica1_db:/data/db
            - shard0-replica1_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/bin/sh", "/scripts/entrypoint-shard0.sh"]
        restart: always

# Shard 1 Replica Set
    shard1-replica0:
        container_name: shard1-replica0
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - shard1-replica0_db:/data/db
            - shard1-replica0_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/bin/sh", "/scripts/entrypoint-shard1.sh"]
        restart: always

    shard1-replica1:
        container_name: shard1-replica1
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - shard1-replica1_db:/data/db
            - shard1-replica1_config:/data/configdb
        networks:
            - mongo-cluster
        entrypoint: ["/bin/sh", "/scripts/entrypoint-shard1.sh"]
        restart: always

# Mongos Router
    mongos-router0:
        container_name: mongos-router0
        image: mongo:6
        volumes:
            - ./mongo-cluster:/scripts
            - mongos-router0_db:/data/db
            - mongos-router0_config:/data/configdb
        entrypoint: ["/scripts/entrypoint-route.sh"]
        ports:
            - "27017:27017" #!changed
        networks:
            - mongo-cluster
            - bridge2mongo
        restart: always

networks:
    mongo-cluster:
        name: mongo-cluster
        driver: bridge
    bridge2mongo:
        name: bridge2mongo
        driver: bridge

volumes:
    configdb-replica0_db:
    configdb-replica0_config:
    configdb-replica1_db:
    configdb-replica1_config:
    configdb-replica2_db:
    configdb-replica2_config:
    shard0-replica0_db:
    shard0-replica0_config:
    shard0-replica1_db:
    shard0-replica1_config:
    shard1-replica0_db:
    shard1-replica0_config:
    shard1-replica1_db:
    shard1-replica1_config:
    mongos-router0_db:
    mongos-router0_config: